<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–õ–∏–≥–∞ –ü—Ä–æ–≥–Ω–æ–∑–∏—Å—Ç–æ–≤</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b0c10;
      color: #f5f5f5;
      text-align: center;
      margin: 0;
      padding: 15px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .menu {
      margin-bottom: 10px;
    }
    .menu button {
      background: #45f3ff;
      border: none;
      padding: 8px 12px;
      border-radius: 7px;
      margin: 4px;
      cursor: pointer;
      font-size: 14px;
      color: #000;
    }
    .screen {
      display: none;
      margin-top: 10px;
      background: #1f2833;
      padding: 15px;
      border-radius: 10px;
    }
    .club-btn {
      background: #243447;
      padding: 12px;
      margin: 5px auto;
      border-radius: 10px;
      max-width: 260px;
      cursor: pointer;
      border: 1px solid #2e3b4e;
    }
    .club-btn:hover {
      background: #2d3b4d;
    }
    .club-selected {
      border: 2px solid #45f3ff;
      background: #16202a;
    }
    button {
      border: none;
      padding: 7px 12px;
      border-radius: 7px;
      cursor: pointer;
      margin-top: 5px;
    }
    input, select {
      padding: 5px;
      border-radius: 5px;
      border: none;
      margin: 3px;
    }
    input[type="number"] {
      width: 70px;
      text-align: center;
    }
    .table-wrapper {
      max-height: 260px;
      overflow-y: auto;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #2e3b4e;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      border-bottom: 1px solid #34495e;
      padding: 6px;
    }
    th {
      font-weight: bold;
      position: sticky;
      top: 0;
      background: #1f2833;
    }
    .nick {
      color: #45f3ff;
      cursor: pointer;
    }
    .nick:hover {
      text-decoration: underline;
    }
    .rewards-list {
      text-align: left;
      max-width: 420px;
      margin: 0 auto;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 12px;
      margin-left: 4px;
      background: #45f3ff;
      color: #000;
    }
    .admin-block {
      display: none;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #444;
      text-align: left;
    }
    .admin-block h3, .admin-block h4 {
      text-align: center;
    }
    .admin-match {
      border: 1px solid #34495e;
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 8px;
    }
    .admin-small-btn {
      font-size: 12px;
      padding: 4px 8px;
      margin-left: 5px;
      background: #ff4f4f;
      color: #fff;
    }
    .note {
      font-size: 12px;
      color: #ccc;
      margin-top: 6px;
    }
    .disabled-text {
      color: #aaa;
      font-size: 13px;
    }
    .strike-last {
      font-size: 13px;
      margin-top: 8px;
    }
    .strike-last span {
      font-weight: bold;
    }
    .admin-login {
      margin-top: 25px;
      font-size: 13px;
      color: #bbb;
    }
    .strike-card {
      text-align: left;
      max-width: 430px;
      margin: 0 auto 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #34495e;
      background: #16202a;
    }
    .strike-header {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .strike-bank {
      font-size: 13px;
      margin: 4px 0;
    }
    .strike-form-row {
      margin: 4px 0;
    }
  </style>
</head>
<body>

<h1>‚öΩ –õ–∏–≥–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Å—Ç–æ–≤</h1>

<div class="menu">
  <button onclick="openScreen('home')">–ì–ª–∞–≤–Ω–∞—è</button>
  <button onclick="openScreen('table')">–¢–∞–±–ª–∏—Ü–∞</button>
  <button onclick="openScreen('predictions')">–ü—Ä–æ–≥–Ω–æ–∑</button>
  <button onclick="openScreen('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="openScreen('rewards')">–ù–∞–≥—Ä–∞–¥—ã</button>
  <button onclick="openScreen('strike')">‚≠ê –°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É</button>
</div>

<!-- –í–´–ë–û–† –ö–õ–£–ë–ê -->
<div id="clubSelect">
  <h3>–í—ã–±–µ—Ä–∏ –ª—é–±–∏–º—ã–π –∫–ª—É–± (1 —Ä–∞–∑ –∑–∞ —Å–µ–∑–æ–Ω)</h3>
  <div class="club-btn" onclick="selectClub(this, '–ë–∞—Ä—Å–µ–ª–æ–Ω–∞')">üîµüî¥ –ë–∞—Ä—Å–µ–ª–æ–Ω–∞</div>
  <div class="club-btn" onclick="selectClub(this, '–†–µ–∞–ª –ú–∞–¥—Ä–∏–¥')">‚ö™ –†–µ–∞–ª –ú–∞–¥—Ä–∏–¥</div>
  <div class="club-btn" onclick="selectClub(this, '–ë–∞–≤–∞—Ä–∏—è')">üî¥ –ë–∞–≤–∞—Ä–∏—è</div>
  <div class="club-btn" onclick="selectClub(this, '–ê—Ä—Å–µ–Ω–∞–ª')">üî¥ –ê—Ä—Å–µ–Ω–∞–ª</div>
  <div class="club-btn" onclick="selectClub(this, '–õ–∏–≤–µ—Ä–ø—É–ª—å')">üî¥ –õ–∏–≤–µ—Ä–ø—É–ª—å</div>
  <div class="club-btn" onclick="selectClub(this, '–ú–∞–Ω—á–µ—Å—Ç–µ—Ä –Æ–Ω–∞–π—Ç–µ–¥')">üî¥ –ú–∞–Ω—á–µ—Å—Ç–µ—Ä –Æ–Ω–∞–π—Ç–µ–¥</div>
  <div class="club-btn" onclick="selectClub(this, '–ú–∞–Ω—á–µ—Å—Ç–µ—Ä –°–∏—Ç–∏')">üî∑ –ú–∞–Ω—á–µ—Å—Ç–µ—Ä –°–∏—Ç–∏</div>
  <div class="club-btn" onclick="selectClub(this, '–ü–°–ñ')">üîµüî¥ –ü–°–ñ</div>
  <button id="clubConfirm" disabled onclick="confirmClub()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</button>
</div>

<!-- –ì–õ–ê–í–ù–ê–Ø -->
<div id="home" class="screen">
  <h2>–ì–ª–∞–≤–Ω–∞—è</h2>
  <p>–ù–∏–∫: <span id="homeNick">‚Äî</span></p>
  <p>–õ—é–±–∏–º—ã–π –∫–ª—É–±: <span id="homeClub">‚Äî</span></p>
  <p>–¢–≤–æ–∏ –æ—á–∫–∏: <span id="homePoints">0</span></p>
  <p>–¢–≤–æ—ë –º–µ—Å—Ç–æ: <span id="homePlace">‚Äî</span></p>
  <p>–ë–∞–ª–∞–Ω—Å: <b><span id="homeStars">0</span> ‚≠ê</b></p>
  <p>–ë–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à: <span id="homeTickets">0</span></p>

  <p>
    <button onclick="topupStars()" style="margin-right:6px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å ‚≠ê</button>
    <button onclick="withdrawStars()">–í—ã–≤–µ—Å—Ç–∏ ‚≠ê</button>
  </p>
</div>

<!-- –¢–ê–ë–õ–ò–¶–ê -->
<div id="table" class="screen">
  <h2>–¢–∞–±–ª–∏—Ü–∞</h2>
  <div class="table-wrapper">
    <table>
      <thead>
      <tr><th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–û—á–∫–∏</th></tr>
      </thead>
      <tbody id="playersTable"></tbody>
    </table>
  </div>
</div>

<!-- –ü–†–û–ì–ù–û–ó–´ -->
<div id="predictions" class="screen">
  <h2>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Ç—É—Ä</h2>
  <p>–í–≤–µ–¥–∏ —Å—á—ë—Ç—ã –º–∞—Ç—á–µ–π –∏ –Ω–∞–∂–º–∏ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑¬ª</p>
  <div id="matchesList"></div>
  <button onclick="submitPredictions()" id="predictionsButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>
  <p id="predictionsResult"></p>

  <!-- –ê–î–ú–ò–ù: –ú–ê–¢–ß–ò –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
  <div id="adminMatchesBlock" class="admin-block">
    <h3>–ê–¥–º–∏–Ω: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∞—Ç—á–µ–π –∏ –¥–µ–¥–ª–∞–π–Ω—ã</h3>
    <p class="note">–ó–∞–¥–∞–π —Ä–µ–∞–ª—å–Ω—ã–µ —Å—á—ë—Ç—ã –∏ –¥–µ–¥–ª–∞–π–Ω—ã –ø–æ –∫–∞–∂–¥–æ–º—É –º–∞—Ç—á—É —Ç—É—Ä–∞.</p>
    <div id="adminMatchesContainer"></div>
    <button onclick="saveAdminMatches()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –¥–µ–¥–ª–∞–π–Ω—ã</button>

    <h4 style="margin-top:18px;">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á –≤ —Ç—É—Ä</h4>
    <p>
      –î–æ–º–∞—à–Ω—è—è –∫–æ–º–∞–Ω–¥–∞:
      <input id="adminNewHome" placeholder="–î–æ–º">
      –ì–æ—Å—Ç–∏:
      <input id="adminNewAway" placeholder="–ì–æ—Å—Ç–∏">
    </p>
    <p>
      –î–µ–¥–ª–∞–π–Ω (—Ñ–æ—Ä–º–∞—Ç 2025-11-30T21:00:00+03:00):<br>
      <input id="adminNewDeadline" style="width:260px;">
    </p>
    <button onclick="addMatch()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á</button>
  </div>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profile" class="screen">
  <h2>–¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
  <p>–ù–∏–∫: <b id="profileNick"></b></p>
  <p>–õ—é–±–∏–º—ã–π –∫–ª—É–±: <span id="profileClub">‚Äî</span></p>
  <p>–û—á–∫–∏: <span id="profilePoints">0</span></p>
  <p>–°—ã–≥—Ä–∞–Ω–æ —Ç—É—Ä–æ–≤: <span id="profileTours">0</span></p>
  <p>–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤: <span id="profileAccuracy">0%</span></p>
  <p>–õ—É—á—à–∏–π —Ç—É—Ä: –ø–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
  <p>–ë–∞–ª–∞–Ω—Å: <span id="profileStars">0</span> ‚≠ê</p>
  <p>–ë–∏–ª–µ—Ç—ã: <span id="profileTickets">0</span></p>
</div>

<!-- –ü–†–û–§–ò–õ–¨ –ò–ì–†–û–ö–ê -->
<div id="playerModal" class="screen">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞</h2>
  <p>–ù–∏–∫: <span id="pmNick"></span></p>
  <p>–ú–µ—Å—Ç–æ: <span id="pmPlace"></span></p>
  <p>–û—á–∫–∏: <span id="pmPoints"></span></p>
  <p>–õ—é–±–∏–º—ã–π –∫–ª—É–±: <span id="pmClub"></span></p>
  <p>–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤: <span id="pmAccuracy"></span>%</p>
  <p>–õ—É—á—à–∏–π —Ç—É—Ä: <span id="pmBestRound"></span></p>
  <button onclick="openScreen('table')">–ù–∞–∑–∞–¥ –∫ —Ç–∞–±–ª–∏—Ü–µ</button>
</div>

<!-- –ù–ê–ì–†–ê–î–´ -->
<div id="rewards" class="screen">
  <h2>–ù–∞–≥—Ä–∞–¥—ã —Å–µ–∑–æ–Ω–∞</h2>
  <div class="rewards-list">
    <p><b>üèÜ 1 –º–µ—Å—Ç–æ:</b> —Ñ—É—Ç–±–æ–ª–∫–∞ –ª—é–±–∏–º–æ–≥–æ –∫–ª—É–±–∞</p>
    <p><b>ü•à 2 –º–µ—Å—Ç–æ:</b> –±–∏–ª–µ—Ç –Ω–∞ —Ñ—É—Ç–±–æ–ª –≤ –ª—é–±–æ–º –≥–æ—Ä–æ–¥–µ (–¥–æ 5 000 ‚ÇΩ)</p>
    <p><b>ü•â 3 –º–µ—Å—Ç–æ:</b> Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞</p>
    <hr>
    <p><b>üéü –ê—á–∏–≤–∫–∏ = –±–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à:</b></p>
    <ul>
      <li>¬´100% –ø–µ—Ä–≤—ã–π —Ç—É—Ä¬ª <span class="badge">+1 –±–∏–ª–µ—Ç</span></li>
      <li>¬´3 —Ç–æ—á–Ω—ã—Ö —Å—á—ë—Ç–∞ –ø–æ–¥—Ä—è–¥¬ª <span class="badge">+2 –±–∏–ª–µ—Ç–∞</span></li>
      <li>¬´–ò–¥–µ–∞–ª—å–Ω—ã–π —Ç—É—Ä –ø–æ –∏—Å—Ö–æ–¥–∞–º¬ª <span class="badge">+3 –±–∏–ª–µ—Ç–∞</span></li>
      <li>¬´10 —Ç—É—Ä–æ–≤¬ª / ¬´50 —Ç—É—Ä–æ–≤¬ª / ¬´100 —Ç—É—Ä–æ–≤¬ª <span class="badge">+1 / +3 / +5</span></li>
      <li>¬´–ö–æ—Ä–æ–ª—å –∏—Å—Ö–æ–¥–æ–≤¬ª (—Ç–æ–ø –ø–æ % –∏—Å—Ö–æ–¥–æ–≤) <span class="badge">+5 –±–∏–ª–µ—Ç–æ–≤</span></li>
      <li>–ó–∞ –≤—ã–∏–≥—Ä—ã—à –≤ —Ä–µ–∂–∏–º–µ —Å—Ç–∞–≤–æ–∫ –Ω–∞ –ø–æ–±–µ–¥—É <span class="badge">+1 –±–∏–ª–µ—Ç</span></li>
    </ul>
  </div>
</div>

<!-- –†–ï–ñ–ò–ú: –°–¢–ê–í–ö–ê –ù–ê –ü–û–ë–ï–î–£ -->
<div id="strike" class="screen">
  <h2>‚≠ê –°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É</h2>

  <p>–ë–∞–ª–∞–Ω—Å: <b><span id="strikeStars">0</span> ‚≠ê</b></p>
  <p class="note">
    –°—Ç–∞–≤–∏—à—å –∑–≤—ë–∑–¥—ã –Ω–∞ –ø–æ–±–µ–¥—É –æ–¥–Ω–æ–π –∏–∑ –∫–æ–º–∞–Ω–¥. –ù–∏—á—å—è = —Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞.
    –ß–µ–º –±–æ–ª—å—à–µ –∑–≤—ë–∑–¥ —Å—Ç–∞–≤—è—Ç –Ω–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, —Ç–µ–º –±–æ–ª—å—à–µ –º–æ–∂–µ—à—å –≤—ã–∏–≥—Ä–∞—Ç—å —Ç—ã.
  </p>

  <div id="strikeUserMatches"></div>
  <div id="strikeNoMatches" class="disabled-text" style="display:none;">
    –ê–¥–º–∏–Ω –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–∏–ª –º–∞—Ç—á–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞.
  </div>

  <hr style="margin:15px 0;border-color:#444;">

  <!-- –ê–î–ú–ò–ù: –ú–ê–¢–ß–ò –°–¢–ê–í–û–ö -->
  <div id="adminStrikeBlock" class="admin-block">
    <h3>–ê–¥–º–∏–Ω: –º–∞—Ç—á–∏ ¬´–°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É¬ª</h3>
    <p class="note">
      –î–æ–±–∞–≤–ª—è–π –º–∞—Ç—á–∏, –∑–∞–¥–∞–≤–∞–π –¥–µ–¥–ª–∞–π–Ω—ã –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–π –∏—Å—Ö–æ–¥.
      10% –±–∞–Ω–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã ‚Äî —Ç–≤–æ—è –∫–æ–º–∏—Å—Å–∏—è, 90% –ø–æ–ª—É—á–∞—é—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å—Ç–∞–≤–∫–µ.
    </p>

    <div id="adminStrikeMatchesContainer"></div>

    <h4 style="margin-top:18px;">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á</h4>
    <p>
      –î–æ–º: <input id="admStrikeNewHome" style="width:120px;">
      –ì–æ—Å—Ç–∏: <input id="admStrikeNewAway" style="width:120px;">
    </p>
    <p>
      –û–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (–¥–ª—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ):<br>
      <input id="admStrikeNewTimeText" style="width:260px;" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–µ–≥–æ–¥–Ω—è, 21:45 (–ú–°–ö)">
    </p>
    <p>
      –î–µ–¥–ª–∞–π–Ω —Å—Ç–∞–≤–æ–∫ (—Ñ–æ—Ä–º–∞—Ç 2025-11-30T21:45:00+03:00):<br>
      <input id="admStrikeNewDeadline" style="width:260px;">
    </p>
    <button onclick="adminAddStrikeMatch()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç—á</button>
  </div>
</div>

<!-- –í–•–û–î –ê–î–ú–ò–ù–ê -->
<div class="admin-login">
  <p>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è):</p>
  <input id="adminPasswordInput" type="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" style="width:160px;">
  <button onclick="adminLogin()">–í–æ–π—Ç–∏</button>
  <div id="adminLoginError" style="color:#ff7373;margin-top:4px;"></div>
</div>

<script>
  // ==== Telegram WebApp / –ù–∏–∫ ====
  let tg = null;
  let currentUserName = "–ì–æ—Å—Ç—å";

  // –ö–ª—é—á–∏ localStorage
  const KEY_CLUB           = "lp_v4_favoriteClub";
  const KEY_STARS          = "lp_v4_balanceStars";
  const KEY_TICKETS        = "lp_v4_tickets";
  const KEY_USER_POINTS    = "lp_v4_userPoints";
  const KEY_TOTAL_PREDS    = "lp_v4_totalPredictions";
  const KEY_CORRECT_RES    = "lp_v4_correctResults";
  const KEY_TOURS          = "lp_v4_totalTours";
  const KEY_MATCHES        = "lp_v4_matches";
  const KEY_STRIKE_MATCHES = "lp_v4_strikeMatches";

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  let favoriteClub   = localStorage.getItem(KEY_CLUB) || null;
  let balanceStars   = parseInt(localStorage.getItem(KEY_STARS) || "0", 10);
  let tickets        = parseInt(localStorage.getItem(KEY_TICKETS) || "0", 10);
  let userPoints     = parseInt(localStorage.getItem(KEY_USER_POINTS) || "0", 10);
  let totalPredictions = parseInt(localStorage.getItem(KEY_TOTAL_PREDS) || "0", 10);
  let correctResults   = parseInt(localStorage.getItem(KEY_CORRECT_RES) || "0", 10);
  let totalTours       = parseInt(localStorage.getItem(KEY_TOURS) || "0", 10);

  let adminLoggedIn = false;

  // ===== –ú–∞—Ç—á–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∏–≥–∏ =====
  function defaultMatches() {
    return [];
  }

  let matches = null;
  try {
    const stored = localStorage.getItem(KEY_MATCHES);
    matches = stored ? JSON.parse(stored) : null;
  } catch (e) {
    matches = null;
  }
  if (!Array.isArray(matches)) {
    matches = defaultMatches();
  }

  function saveMatches() {
    localStorage.setItem(KEY_MATCHES, JSON.stringify(matches));
  }

  // ===== –ú–∞—Ç—á–∏ "–°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É" =====
  let strikeMatches = [];
  try {
    const sm = localStorage.getItem(KEY_STRIKE_MATCHES);
    strikeMatches = sm ? JSON.parse(sm) : [];
  } catch (e) {
    strikeMatches = [];
  }
  if (!Array.isArray(strikeMatches)) {
    strikeMatches = [];
  }

  function saveStrikeMatches() {
    localStorage.setItem(KEY_STRIKE_MATCHES, JSON.stringify(strikeMatches));
  }

  // –û–±—â–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/UI
  function saveAllBase() {
    localStorage.setItem(KEY_CLUB, favoriteClub || "");
    localStorage.setItem(KEY_STARS, String(balanceStars));
    localStorage.setItem(KEY_TICKETS, String(tickets));
    localStorage.setItem(KEY_USER_POINTS, String(userPoints));
    localStorage.setItem(KEY_TOTAL_PREDS, String(totalPredictions));
    localStorage.setItem(KEY_CORRECT_RES, String(correctResults));
    localStorage.setItem(KEY_TOURS, String(totalTours));
  }

  function openScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.style.display = "none");
    document.getElementById(id).style.display = "block";
  }

  function updateBalancesUI() {
    document.getElementById("homeStars").innerText    = balanceStars;
    document.getElementById("profileStars").innerText = balanceStars;
    document.getElementById("strikeStars").innerText  = balanceStars;
  }

  function updateClubUI() {
    const c = favoriteClub || "–Ω–µ –≤—ã–±—Ä–∞–Ω";
    document.getElementById("homeClub").innerText    = c;
    document.getElementById("profileClub").innerText = c;
  }

  function updateTicketsUI() {
    document.getElementById("homeTickets").innerText    = tickets;
    document.getElementById("profileTickets").innerText = tickets;
  }

  function updatePointsAndStatsUI() {
    document.getElementById("homePoints").innerText    = userPoints;
    document.getElementById("profilePoints").innerText = userPoints;
    document.getElementById("profileTours").innerText  = totalTours;
    const acc = totalPredictions > 0
      ? Math.round((correctResults / totalPredictions) * 100)
      : 0;
    document.getElementById("profileAccuracy").innerText = acc + "%";
  }

  function updateNickUI() {
    document.getElementById("homeNick").innerText    = currentUserName;
    document.getElementById("profileNick").innerText = currentUserName;
  }

  // –í—ã–±–æ—Ä –∫–ª—É–±–∞
  let tempSelectedClub = null;
  function selectClub(elem, clubName) {
    document.querySelectorAll(".club-btn").forEach(c => c.classList.remove("club-selected"));
    elem.classList.add("club-selected");
    tempSelectedClub = clubName;
    document.getElementById("clubConfirm").disabled = false;
  }

  function confirmClub() {
    if (!tempSelectedClub) return;
    favoriteClub = tempSelectedClub;
    saveAllBase();
    updateClubUI();
    document.getElementById("clubSelect").style.display = "none";
    openScreen("home");
    rebuildTable();
  }

  // –¢–∞–±–ª–∏—Ü–∞ ‚Äî –æ–¥–∏–Ω –∏–≥—Ä–æ–∫ (—Ç–µ–∫—É—â–∏–π)
  function getPlayersForTable() {
    const acc = totalPredictions > 0
      ? Math.round((correctResults / totalPredictions) * 100)
      : 0;
    return [{
      name: currentUserName,
      points: userPoints,
      club: favoriteClub || "-",
      accuracy: acc,
      bestRound: "-"
    }];
  }

  function rebuildTable() {
    const tbody = document.getElementById("playersTable");
    tbody.innerHTML = "";
    const players = getPlayersForTable();

    players.forEach((p, index) => {
      const tr = document.createElement("tr");
      const place = index + 1;
      tr.innerHTML = `
        <td>${place}</td>
        <td><span class="nick" onclick="openPlayer('${p.name}')">${p.name}</span></td>
        <td>${p.points}</td>
      `;
      tbody.appendChild(tr);

      if (p.name === currentUserName) {
        document.getElementById("homePlace").innerText = place;
      }
    });
  }

  function openPlayer(nick) {
    const players = getPlayersForTable();
    const idx = players.findIndex(p => p.name === nick);
    if (idx === -1) return;
    const p = players[idx];

    document.getElementById("pmNick").innerText = p.name;
    document.getElementById("pmPlace").innerText = idx + 1;
    document.getElementById("pmPoints").innerText = p.points;
    document.getElementById("pmClub").innerText = p.club || "-";
    document.getElementById("pmAccuracy").innerText = p.accuracy ?? 0;
    document.getElementById("pmBestRound").innerText = p.bestRound || "-";

    openScreen("playerModal");
  }

  // –ü—Ä–æ–≥–Ω–æ–∑—ã –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∏–≥–∏
  function isMatchOpen(m) {
    if (!m.deadline) return true;
    const now = new Date();
    const dl = new Date(m.deadline);
    return now < dl;
  }

  function buildMatchesUI() {
    const container = document.getElementById("matchesList");
    container.innerHTML = "";
    if (!matches.length) {
      const p = document.createElement("p");
      p.className = "disabled-text";
      p.innerText = "–ê–¥–º–∏–Ω –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–∏–ª –º–∞—Ç—á–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Ç—É—Ä–∞.";
      container.appendChild(p);
      return;
    }
    matches.forEach(m => {
      const open = isMatchOpen(m);
      const div = document.createElement("div");
      div.style.margin = "6px 0";
      const deadlineText = m.deadline
        ? `–î–µ–¥–ª–∞–π–Ω: ${m.deadline}`
        : "–î–µ–¥–ª–∞–π–Ω –Ω–µ –∑–∞–¥–∞–Ω";

      if (open) {
        div.innerHTML = `
          ${m.home}
          <input type="number" id="pred-home-${m.id}" min="0" style="width:50px;">
          :
          <input type="number" id="pred-away-${m.id}" min="0" style="width:50px;">
          ${m.away}
          <div class="note">${deadlineText}</div>
        `;
      } else {
        div.innerHTML = `
          <b>${m.home} ‚Äî ${m.away}</b>
          <div class="disabled-text">–ü—Ä–∏—ë–º –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –∑–∞–∫—Ä—ã—Ç</div>
          <div class="note">${deadlineText}</div>
        `;
      }
      container.appendChild(div);
    });
  }

  let predictionsSent = false;

  function submitPredictions() {
    if (predictionsSent) {
      document.getElementById("predictionsResult").innerText =
        "–¢—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —ç—Ç–æ—Ç —Ç—É—Ä.";
      return;
    }

    let gainedPoints = 0;
    let tourPredictions = 0;

    matches.forEach(m => {
      if (!isMatchOpen(m)) return;

      const hStr = document.getElementById(`pred-home-${m.id}`)?.value ?? "";
      const aStr = document.getElementById(`pred-away-${m.id}`)?.value ?? "";
      if (hStr === "" || aStr === "") return;

      const ph = parseInt(hStr, 10);
      const pa = parseInt(aStr, 10);

      tourPredictions++;
      totalPredictions++;

      let pts = 0;
      if (ph === m.realHome && pa === m.realAway) {
        pts = 3;
        correctResults++;
      } else {
        const realDiff = m.realHome - m.realAway;
        const predDiff = ph - pa;
        const realRes = realDiff === 0 ? 0 : (realDiff > 0 ? 1 : -1);
        const predRes = predDiff === 0 ? 0 : (predDiff > 0 ? 1 : -1);
        if (realRes === predRes) {
          pts = 1;
          correctResults++;
        }
      }

      if (favoriteClub && (m.home === favoriteClub || m.away === favoriteClub)) {
        pts *= 2;
      }

      gainedPoints += pts;
    });

    if (tourPredictions === 0) {
      document.getElementById("predictionsResult").innerText =
        "–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ –ø—Ä–æ–≥–Ω–æ–∑ —Ö–æ—Ç—è –±—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –º–∞—Ç—á–∞.";
      return;
    }

    userPoints += gainedPoints;
    totalTours++;
    tickets += 1;

    predictionsSent = true;
    document.getElementById("predictionsButton").disabled = true;
    document.getElementById("predictionsResult").innerText =
      "–¢—É—Ä —Å—ã–≥—Ä–∞–Ω. –¢—ã –Ω–∞–±—Ä–∞–ª " + gainedPoints + " –æ—á–∫–æ–≤.";

    saveAllBase();
    saveMatches();
    updatePointsAndStatsUI();
    updateTicketsUI();
    rebuildTable();
  }

  // –ê–¥–º–∏–Ω: –º–∞—Ç—á–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∏–≥–∏
  function buildAdminMatchesUI() {
    const cont = document.getElementById("adminMatchesContainer");
    if (!cont) return;
    cont.innerHTML = "";
    matches.forEach(m => {
      const div = document.createElement("div");
      div.className = "admin-match";
      div.innerHTML = `
        <h4>${m.home} ‚Äî ${m.away}</h4>
        <p>
          –†–µ–∞–ª—å–Ω—ã–π —Å—á—ë—Ç:
          <input type="number" id="adm-real-home-${m.id}" value="${m.realHome ?? 0}" style="width:60px;">
          :
          <input type="number" id="adm-real-away-${m.id}" value="${m.realAway ?? 0}" style="width:60px;">
        </p>
        <p>
          –î–µ–¥–ª–∞–π–Ω:
          <input id="adm-deadline-${m.id}" style="width:260px;" value="${m.deadline || ""}">
        </p>
        <button class="admin-small-btn" onclick="deleteMatch(${m.id})">‚ùå –£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á</button>
      `;
      cont.appendChild(div);
    });
  }

  function saveAdminMatches() {
    matches.forEach(m => {
      const rh = document.getElementById(`adm-real-home-${m.id}`)?.value ?? "";
      const ra = document.getElementById(`adm-real-away-${m.id}`)?.value ?? "";
      const dl = document.getElementById(`adm-deadline-${m.id}`)?.value ?? "";

      if (rh !== "") m.realHome = parseInt(rh, 10);
      if (ra !== "") m.realAway = parseInt(ra, 10);
      m.deadline = dl || "";
    });
    saveMatches();
    buildMatchesUI();
    alert("–ú–∞—Ç—á–∏ –∏ –¥–µ–¥–ª–∞–π–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.");
  }

  function deleteMatch(id) {
    if (!confirm("–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á –∏–∑ —Ç—É—Ä–∞?")) return;
    matches = matches.filter(m => m.id !== id);
    saveMatches();
    buildMatchesUI();
    buildAdminMatchesUI();
  }

  function addMatch() {
    const home = document.getElementById("adminNewHome").value.trim();
    const away = document.getElementById("adminNewAway").value.trim();
    const deadline = document.getElementById("adminNewDeadline").value.trim();
    if (!home || !away) {
      alert("–ó–∞–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—ã.");
      return;
    }
    const newId = matches.length > 0 ? Math.max(...matches.map(m => m.id)) + 1 : 1;
    matches.push({
      id: newId,
      home,
      away,
      realHome: 0,
      realAway: 0,
      deadline
    });
    document.getElementById("adminNewHome").value = "";
    document.getElementById("adminNewAway").value = "";
    document.getElementById("adminNewDeadline").value = "";
    saveMatches();
    buildMatchesUI();
    buildAdminMatchesUI();
  }

  // ===== –†–µ–∂–∏–º "–°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É" =====
  function strikeIsOpen(match) {
    if (match.settled) return false;
    if (!match.deadline) return true;
    const now = new Date();
    const dl = new Date(match.deadline);
    return now < dl;
  }

  function buildStrikeUserUI() {
    const cont = document.getElementById("strikeUserMatches");
    const noMatches = document.getElementById("strikeNoMatches");
    cont.innerHTML = "";

    const list = strikeMatches;

    if (!list.length) {
      noMatches.style.display = "block";
      return;
    } else {
      noMatches.style.display = "none";
    }

    list.forEach(m => {
      const card = document.createElement("div");
      card.className = "strike-card";

      const totalHome = m.totalHome || 0;
      const totalAway = m.totalAway || 0;
      const bank = totalHome + totalAway;

      const open = strikeIsOpen(m);

      let statusHtml = "";
      if (!open && !m.settled) {
        statusHtml = `<div class="disabled-text">–ü—Ä–∏—ë–º —Å—Ç–∞–≤–æ–∫ –∑–∞–∫—Ä—ã—Ç. –ñ–¥—ë–º —Ä–∞—Å—á—ë—Ç.</div>`;
      } else if (m.settled) {
        statusHtml = `<div class="disabled-text">–ú–∞—Ç—á —Ä–∞—Å—Å—á–∏—Ç–∞–Ω. –°—Ç–∞–≤–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã.</div>`;
      }

      const myBets = (m.bets || []).filter(b => b.user === currentUserName);
      let lastText = "";
      if (myBets.length > 0) {
        const last = myBets[myBets.length - 1];
        const teamName = last.side === "home" ? m.home : m.away;
        lastText = `–¢–≤–æ—è –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞: ${last.amount} ‚≠ê –Ω–∞ –ø–æ–±–µ–¥—É ¬´${teamName}¬ª`;
      }

      card.innerHTML = `
        <div class="strike-header">${m.home} ‚Äî ${m.away}</div>
        <div class="note">${m.timeText || ""}</div>
        <div class="note">–î–µ–¥–ª–∞–π–Ω —Å—Ç–∞–≤–æ–∫: ${m.deadline || "–Ω–µ –∑–∞–¥–∞–Ω"}</div>
        <div class="strike-bank">
          –ù–∞ ${m.home}: <b>${totalHome}</b> ‚≠ê<br>
          –ù–∞ ${m.away}: <b>${totalAway}</b> ‚≠ê<br>
          –û–±—â–∏–π –±–∞–Ω–∫: <b>${bank}</b> ‚≠ê
        </div>
        ${statusHtml}
        <div id="strike-form-${m.id}"></div>
        <div class="strike-last" id="strike-last-${m.id}">${lastText}</div>
      `;

      cont.appendChild(card);

      const formContainer = document.getElementById(`strike-form-${m.id}`);

      if (open) {
        formContainer.innerHTML = `
          <div class="strike-form-row">
            –°—Ç–æ—Ä–æ–Ω–∞:
            <select id="strike-side-${m.id}">
              <option value="home">–ü–æ–±–µ–¥–∞ ${m.home}</option>
              <option value="away">–ü–æ–±–µ–¥–∞ ${m.away}</option>
            </select>
          </div>
          <div class="strike-form-row">
            –°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (‚≠ê):
            <input type="number" id="strike-amount-${m.id}" min="10" style="width:80px;" oninput="updateStrikePotential(${m.id})">
          </div>
          <div class="strike-form-row note">
            –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 10 ‚≠ê
          </div>
          <div class="strike-form-row">
            –ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à —Å–µ–π—á–∞—Å: <b><span id="strike-potential-${m.id}">0 ‚≠ê</span></b>
          </div>
          <button onclick="makeStrikeBet(${m.id})">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
          <p id="strike-status-${m.id}" class="note"></p>
        `;
      }
    });
  }

  function updateStrikePotential(matchId) {
    const match = strikeMatches.find(m => m.id === matchId);
    if (!match) return;

    const amountStr = document.getElementById(`strike-amount-${matchId}`)?.value || "0";
    const amount = parseFloat(amountStr);
    const side = document.getElementById(`strike-side-${matchId}`)?.value || "home";
    const outEl = document.getElementById(`strike-potential-${matchId}`);

    if (!outEl) return;

    if (amount <= 0 || isNaN(amount)) {
      outEl.innerText = "0 ‚≠ê";
      return;
    }

    let W, L;
    if (side === "home") {
      W = (match.totalHome || 0) + amount;
      L = match.totalAway || 0;
    } else {
      W = (match.totalAway || 0) + amount;
      L = match.totalHome || 0;
    }

    let payout = amount;
    if (W > 0) {
      const commission = Math.floor(L * 0.10);
      const Lafter = L - commission;
      payout = amount + (amount / W) * Lafter;
    }

    outEl.innerText = Math.floor(payout) + " ‚≠ê";
  }

  function makeStrikeBet(matchId) {
    const match = strikeMatches.find(m => m.id === matchId);
    if (!match) return;

    if (!strikeIsOpen(match)) {
      const st = document.getElementById(`strike-status-${matchId}`);
      if (st) st.innerText = "–°—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç—á —É–∂–µ –∑–∞–∫—Ä—ã—Ç—ã.";
      return;
    }

    const amountStr = document.getElementById(`strike-amount-${matchId}`)?.value || "0";
    const side = document.getElementById(`strike-side-${matchId}`)?.value || "home";
    const statusEl = document.getElementById(`strike-status-${matchId}`);

    const amount = parseFloat(amountStr);
    if (isNaN(amount) || amount < 10) {
      if (statusEl) statusEl.innerText = "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 ‚≠ê.";
      return;
    }
    if (amount > balanceStars) {
      if (statusEl) statusEl.innerText = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥. –¢–≤–æ–π –±–∞–ª–∞–Ω—Å: " + balanceStars + " ‚≠ê.";
      return;
    }

    balanceStars -= amount;
    match.bets = match.bets || [];
    match.bets.push({
      user: currentUserName,
      side,
      amount
    });
    if (side === "home") {
      match.totalHome = (match.totalHome || 0) + amount;
    } else {
      match.totalAway = (match.totalAway || 0) + amount;
    }

    saveAllBase();
    saveStrikeMatches();
    updateBalancesUI();
    buildStrikeUserUI();

    const st = document.getElementById(`strike-status-${matchId}`);
    if (st) st.innerText = "‚úÖ –°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞.";
  }

  // –ê–¥–º–∏–Ω: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∞–º–∏
  function buildAdminStrikeUI() {
    const cont = document.getElementById("adminStrikeMatchesContainer");
    if (!cont) return;
    cont.innerHTML = "";

    strikeMatches.forEach(m => {
      const div = document.createElement("div");
      div.className = "admin-match";

      const bank = (m.totalHome || 0) + (m.totalAway || 0);
      const statusText = m.settled ? "—Ä–∞—Å—Å—á–∏—Ç–∞–Ω" : (strikeIsOpen(m) ? "–æ—Ç–∫—Ä—ã—Ç" : "–¥–µ–¥–ª–∞–π–Ω –ø—Ä–æ—à—ë–ª, –∂–¥—ë—Ç —Ä–∞—Å—á—ë—Ç");

      div.innerHTML = `
        <h4>${m.home} ‚Äî ${m.away}</h4>
        <p>${m.timeText || ""}</p>
        <p>–î–µ–¥–ª–∞–π–Ω: ${m.deadline || "–Ω–µ –∑–∞–¥–∞–Ω"}</p>
        <p>–ü–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: ${m.totalHome || 0} ‚≠ê –Ω–∞ ${m.home}, ${m.totalAway || 0} ‚≠ê –Ω–∞ ${m.away}</p>
        <p>–û–±—â–∏–π –±–∞–Ω–∫: ${bank} ‚≠ê</p>
        <p>–°—Ç–∞—Ç—É—Å: <b>${statusText}</b></p>
        <p>
          –°—á—ë—Ç –º–∞—Ç—á–∞:
          <input type="number" id="adm-strike-real-home-${m.id}" style="width:60px;" placeholder="–î–æ–º">
          :
          <input type="number" id="adm-strike-real-away-${m.id}" style="width:60px;" placeholder="–ì–æ—Å—Ç–∏">
        </p>
        <button onclick="adminSettleStrikeMatch(${m.id})">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ç—á</button>
        <button class="admin-small-btn" onclick="adminDeleteStrikeMatch(${m.id})">‚ùå –£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á</button>
      `;
      cont.appendChild(div);
    });
  }

  function adminAddStrikeMatch() {
    const home = document.getElementById("admStrikeNewHome").value.trim();
    const away = document.getElementById("admStrikeNewAway").value.trim();
    const timeText = document.getElementById("admStrikeNewTimeText").value.trim();
    const deadline = document.getElementById("admStrikeNewDeadline").value.trim();

    if (!home || !away) {
      alert("–ó–∞–ø–æ–ª–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥.");
      return;
    }

    const newId = strikeMatches.length > 0 ? Math.max(...strikeMatches.map(m => m.id)) + 1 : 1;
    strikeMatches.push({
      id: newId,
      home,
      away,
      timeText,
      deadline,
      totalHome: 0,
      totalAway: 0,
      bets: [],
      settled: false
    });

    document.getElementById("admStrikeNewHome").value = "";
    document.getElementById("admStrikeNewAway").value = "";
    document.getElementById("admStrikeNewTimeText").value = "";
    document.getElementById("admStrikeNewDeadline").value = "";

    saveStrikeMatches();
    buildStrikeUserUI();
    buildAdminStrikeUI();
  }

  function adminDeleteStrikeMatch(id) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á –∏–∑ —Ä–µ–∂–∏–º–∞ —Å—Ç–∞–≤–æ–∫?")) return;
    strikeMatches = strikeMatches.filter(m => m.id !== id);
    saveStrikeMatches();
    buildStrikeUserUI();
    buildAdminStrikeUI();
  }

  function adminSettleStrikeMatch(id) {
    const m = strikeMatches.find(x => x.id === id);
    if (!m) return;

    if (m.settled) {
      alert("–≠—Ç–æ—Ç –º–∞—Ç—á —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω.");
      return;
    }

    const rhStr = document.getElementById(`adm-strike-real-home-${id}`)?.value || "";
    const raStr = document.getElementById(`adm-strike-real-away-${id}`)?.value || "";

    if (rhStr === "" || raStr === "") {
      alert("–í–≤–µ–¥–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—á—ë—Ç –º–∞—Ç—á–∞.");
      return;
    }

    const rh = parseInt(rhStr, 10);
    const ra = parseInt(raStr, 10);
    let resultSide = null; // 'home' | 'away' | null (–Ω–∏—á—å—è)

    if (rh > ra) resultSide = "home";
    else if (ra > rh) resultSide = "away";
    else resultSide = null; // –Ω–∏—á—å—è = –≤—Å–µ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏

    const totalHome = m.totalHome || 0;
    const totalAway = m.totalAway || 0;

    if (!resultSide) {
      // –Ω–∏—á—å—è: –≤—Å–µ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏, –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –±–µ—Ä—ë—Ç—Å—è
      m.settled = true;
      m.bets = [];
      m.totalHome = 0;
      m.totalAway = 0;
      saveStrikeMatches();
      buildStrikeUserUI();
      buildAdminStrikeUI();
      alert("–ù–∏—á—å—è: –≤—Å–µ —Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.");
      return;
    }

    const W = resultSide === "home" ? totalHome : totalAway;
    const L = resultSide === "home" ? totalAway : totalHome;

    if (W <= 0) {
      m.settled = true;
      m.bets = [];
      m.totalHome = 0;
      m.totalAway = 0;
      saveStrikeMatches();
      buildStrikeUserUI();
      buildAdminStrikeUI();
      alert("–ù–∞ –ø–æ–±–µ–¥–∏–≤—à—É—é –∫–æ–º–∞–Ω–¥—É –Ω–µ –±—ã–ª–æ —Å—Ç–∞–≤–æ–∫, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ—á–µ–≥–æ.");
      return;
    }

    const commission = Math.floor(L * 0.10);
    const Lafter = L - commission;

    let totalPayoutForUser = 0;
    (m.bets || []).forEach(b => {
      if (b.side === resultSide) {
        const payout = Math.floor(b.amount + (b.amount / W) * Lafter);
        if (b.user === currentUserName) {
          totalPayoutForUser += payout;
        }
      }
    });

    const totalGain = totalPayoutForUser + commission;

    if (totalGain > 0) {
      balanceStars += totalGain;
      saveAllBase();
      updateBalancesUI();
    }

    m.settled = true;
    m.bets = [];
    m.totalHome = 0;
    m.totalAway = 0;

    saveStrikeMatches();
    buildStrikeUserUI();
    buildAdminStrikeUI();

    alert("–ú–∞—Ç—á —Ä–∞—Å—Å—á–∏—Ç–∞–Ω. –í—ã–∏–≥—Ä—ã—à –∏ –∫–æ–º–∏—Å—Å–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å.");
  }

  // ===== –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ / –≤—ã–≤–æ–¥ –∑–≤—ë–∑–¥ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º) =====
  function topupStars() {
    const amountStr = prompt("–ù–∞ —Å–∫–æ–ª—å–∫–æ ‚≠ê –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å?");
    if (!amountStr) return;
    const amount = parseInt(amountStr, 10);
    if (isNaN(amount) || amount <= 0) {
      alert("–í–≤–µ–¥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ –∑–≤—ë–∑–¥.");
      return;
    }

    if (!tg) {
      alert("–û—Ç–∫—Ä–æ–π –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram, —á—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å.");
      return;
    }

    tg.sendData(JSON.stringify({
      type: "topup_request",
      amount: amount
    }));
    alert("–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –±–æ—Ç–∞.");
  }

  function withdrawStars() {
    const amountStr = prompt("–°–∫–æ–ª—å–∫–æ ‚≠ê —Ö–æ—á–µ—à—å –≤—ã–≤–µ—Å—Ç–∏?");
    if (!amountStr) return;
    const amount = parseInt(amountStr, 10);
    if (isNaN(amount) || amount <= 0) {
      alert("–í–≤–µ–¥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ –∑–≤—ë–∑–¥.");
      return;
    }

    if (!tg) {
      alert("–û—Ç–∫—Ä–æ–π –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥.");
      return;
    }

    tg.sendData(JSON.stringify({
      type: "withdraw_request",
      amount: amount
    }));
    alert("–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω—É.");
  }

  // –ê–¥–º–∏–Ω ‚Äî –≤—Ö–æ–¥
  function adminLogin() {
    const pass = document.getElementById("adminPasswordInput").value;
    if (pass === "0235") {
      adminLoggedIn = true;
      document.getElementById("adminLoginError").innerText = "";
      document.querySelectorAll(".admin-block").forEach(b => b.style.display = "block");
      buildAdminMatchesUI();
      buildAdminStrikeUI();
      alert("–ê–¥–º–∏–Ω-—Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω.");
    } else {
      document.getElementById("adminLoginError").innerText = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.";
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  document.addEventListener("DOMContentLoaded", function () {
    // Telegram init + –Ω–∏–∫
    try {
      tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    } catch (e) {
      tg = null;
    }

    if (tg) {
      tg.expand();
      const init = tg.initDataUnsafe || {};
      const user = init.user || {};
      if (user.username) {
        currentUserName = user.username;
      } else {
        const fn = user.first_name || "";
        const ln = user.last_name || "";
        const name = (fn + " " + ln).trim();
        if (name) currentUserName = name;
      }
    }

    updateNickUI();
    updateBalancesUI();
    updateClubUI();
    updateTicketsUI();
    updatePointsAndStatsUI();
    buildMatchesUI();
    rebuildTable();
    buildStrikeUserUI();

    if (favoriteClub) {
      document.getElementById("clubSelect").style.display = "none";
      openScreen("home");
    } else {
      document.getElementById("clubSelect").style.display = "block";
    }
  });
</script>

</body>
</html>
